<section class="shops-content">
  <div class="shops-content__top">
    <div class="container">
      <div class="shops-content__inner">
        <form action="#" class="shops-content__form">
          <label  class="shops-content__label">
            <svg class="shops-content__icon" width="20px" height="20px" viewBox="0 0 20 20" fill="none"
              xmlns="http://www.w3.org/2000/svg">
              <circle cx="9.80589" cy="9.80541" r="7.49047" stroke="#666666" stroke-width="1.5" stroke-linecap="round"
                stroke-linejoin="round" />
              <path d="M15.0156 15.4043L17.9523 18.3334" stroke="#666666" stroke-width="1.5" stroke-linecap="round"
                stroke-linejoin="round" />
            </svg>

          <input type="search" name="shops-search" class="small-input shops-content__input"
            placeholder="Название,адрес или метро">
          </label>
        </form>
        <label class="custom-checkbox">
          <input class="custom-checkbox__field" type="checkbox" name="Открыт сейчас">
          <span class="custom-checkbox__content">Открыт сейчас</span>
        </label>
        <label class="custom-checkbox">
          <input class="custom-checkbox__field" type="checkbox" name="Рядом">
          <span class="custom-checkbox__content">Рядом</span>
        </label>

      </div>
    </div>
  </div>
  <div class="shops-content__bottom">
    <div class="container">
      <div class="shops-content__wrapper shops-content__grid">
        <div class="shops-content__left">
          <div class="shops-content__items" data-simplebar="init">
            <div class="shops-content__item">
              <h3 class="shops-content__subtitle">Приморский</h3>
              <div class="shops-content__metro shops-content__metro--green">Сокол</div>
              <div class="shops-content__address">г Москва ул Ясеневая 34 </div>
              <div class="shops-content__sh">9.00 - 20.00</div>
              <button class="btn-reset shops-content__btn" data-shop="primorsky" aria-label="Перейти к маркеру на карте"></button>
            </div>
            <div class="shops-content__item">
              <h3 class="shops-content__subtitle">Адмиралтейский</h3>
              <div class="shops-content__metro shops-content__metro--green">Сокол</div>
              <div class="shops-content__address">г Москва ул Ясеневая 34 </div>
              <div class="shops-content__sh">9.00 - 20.00</div>
              <button class="btn-reset shops-content__btn" data-shop="primorsky" aria-label="Перейти к маркеру на карте"></button>
            </div>
            <div class="shops-content__item">
              <h3 class="shops-content__subtitle">Центральный</h3>
              <div class="shops-content__metro shops-content__metro--green">Сокол</div>
              <div class="shops-content__address">г Москва ул Ясеневая 34 </div>
              <div class="shops-content__sh">9.00 - 20.00</div>
              <button class="btn-reset shops-content__btn" data-shop="primorsky" aria-label="Перейти к маркеру на карте"></button>
            </div>
          </div>
        </div>
        <div class="shops-content__right">
          <div class="controls">
            <button class="map-btn active" data-type="map">Схема</button>
            <button class="map-btn" data-type="satellite">Спутник</button>
            <button class="map-btn" data-type="hybrid">Гибрид</button>

          </div>

          <div id="map" class="shops-content__map"  style="width: 100%; height: 400px;"></div>

        </div>
      </div>
    </div>
  </div>
      <style>
        #map {
          width: 100%;
          height: 400px;
          margin: 10px 0;
          border: 1px solid #ccc;
          border-radius: 8px;
          background: #0066ff;
        }

        .controls {
          margin: 20px 0;
          display: flex;
          gap: 10px;
          flex-wrap: wrap;
        }

        /* .map-btn {
          padding: 10px 20px;
          background: #0066ff;
          color: white;
          border: none;
          border-radius: 4px;
          cursor: pointer;
          font-size: 14px;
          transition: background 0.3s;
        } */

        /* .map-btn:hover {
          background: #0052cc;
        } */

        /* .map-btn.active {
          background: #003d99;
        } */

        .info {
          margin-top: 20px;
          padding: 15px;
          background: #f5f5f5;
          border-radius: 4px;
        }
        /*  */
              .map-btn {
        padding: 10px 20px;
        background: #0066ff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        transition: background 0.3s;
        margin: 5px;
      }

      .map-btn:hover {
        background: #0052cc;
      }

      .map-btn.active {
        background: #003d99;
        box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
      }
      </style>


      <!-- <script>
        document.querySelectorAll('#map .ymaps-2-1-79-map').forEach((map, i) => i > 0 && map.remove());
        // Полная очистка перед созданием новой карты
        ymaps.ready(function () {
          var mapContainer = document.getElementById('map');

          if (!mapContainer) {
            console.error('Контейнер не найден');
            return;
          }

          // УДАЛЯЕМ ВСЕ старые карты
          var oldMaps = mapContainer.querySelectorAll('.ymaps-2-1-79-map');
          oldMaps.forEach(function (map) {
            map.remove();
          });

          // Очищаем контейнер
          mapContainer.innerHTML = '';

          // Создаем новую карту
          var myMap = new ymaps.Map('map', {
            center: [55.76, 37.64],
            zoom: 10,
            controls: ['zoomControl', 'fullscreenControl']
          });

          // Только одна метка
          var placemark = new ymaps.Placemark([55.76, 37.64], {
            hintContent: 'Москва',
            balloonContent: 'Столица России'
          });

          myMap.geoObjects.add(placemark);
          // --------------------------
                // Добавляем несколько меток


          var additionalPlaces = [
            {
              coords: [55.751, 37.618],
              name: 'Красная площадь',
              description: 'Главная площадь Москвы'
            },
            {
              coords: [55.709, 37.603],
              name: 'Парк Горького',
              description: 'Центральный парк культуры и отдыха'
            },
            {
              coords: [55.715, 37.553],
              name: 'МГУ',
              description: 'Московский государственный университет'
            }
          ];

          additionalPlaces.forEach(function (place) {
            var placemark = new ymaps.Placemark(place.coords, {
              hintContent: place.name,
              balloonContent: place.description
            }, {
              preset: 'islands#blueIcon'
            });

            myMap.geoObjects.add(placemark);
          });

          // Поиск по карте
          var searchControl = new ymaps.control.SearchControl({
            options: {
              provider: 'yandex#search',
              noPlacemark: false
            }
          });

          myMap.controls.add(searchControl);

          // Координаты при клике
          myMap.events.add('click', function (event) {
            var coords = event.get('coords');

            // Если клик по карте (не по метке)
            if (!event.get('target').properties) {
              var clickPlacemark = new ymaps.Placemark(coords, {
                balloonContent: 'Вы кликнули по координатам: ' + coords
              }, {
                preset: 'islands#greenIcon'
              });

              myMap.geoObjects.add(clickPlacemark);

              // Удаляем старую метку через 5 секунд
              setTimeout(function () {
                myMap.geoObjects.remove(clickPlacemark);
              }, 5000);
            }
          });

// ------------------------------------------
          // Кнопки
          document.querySelectorAll('.map-btn').forEach(function (btn) {
            btn.onclick = function () {
              var type = this.getAttribute('data-type');
              myMap.setType('yandex#' + type);

              document.querySelectorAll('.map-btn').forEach(function (b) {
                b.classList.remove('active');
              });
              this.classList.add('active');
            };
          });
        });
      </script> -->
      <script>

        ymaps.ready(function () {
          // 1. Проверяем наличие контейнера
          var mapContainer = document.getElementById('map');
          if (!mapContainer) {
            console.error('Контейнер карты не найден');
            return;
          }

          // 2. Сохраняем размеры контейнера перед очисткой
          var containerStyles = {
            width: mapContainer.style.width || '100%',
            height: mapContainer.style.height || '400px'
          };

          // 3. Полная очистка контейнера
          mapContainer.innerHTML = '';

          // Восстанавливаем размеры
          mapContainer.style.width = containerStyles.width;
          mapContainer.style.height = containerStyles.height;

          try {
            // 4. Создаем карту
            var myMap = new ymaps.Map('map', {
              center: [55.76, 37.64],
              zoom: 10,
              controls: ['zoomControl', 'fullscreenControl', 'typeSelector'] // Добавил typeSelector
            });

            console.log('Карта создана успешно');

            // 5. Основная метка (используем другое имя переменной)
            var mainPlacemark = new ymaps.Placemark([55.76, 37.64], {
              hintContent: 'Москва',
              balloonContent: 'Столица России'
            }, {
              preset: 'islands#redIcon' // Добавил стиль
            });

            myMap.geoObjects.add(mainPlacemark);

            // 6. Дополнительные метки
            var additionalPlaces = [
              {
                coords: [55.751, 37.618],
                name: 'Красная площадь',
                description: 'Главная площадь Москвы'
              },
              {
                coords: [55.709, 37.603],
                name: 'Парк Горького',
                description: 'Центральный парк культуры и отдыха'
              },
              {
                coords: [55.715, 37.553],
                name: 'МГУ',
                description: 'Московский государственный университет'
              }
            ];

            additionalPlaces.forEach(function (place) {
              var additionalPlacemark = new ymaps.Placemark(place.coords, {
                hintContent: place.name,
                balloonContent: place.description
              }, {
                preset: 'islands#blueIcon',
                iconColor: '#1e98ff'
              });

              myMap.geoObjects.add(additionalPlacemark);
            });

            // 7. Поиск по карте
            var searchControl = new ymaps.control.SearchControl({
              options: {
                provider: 'yandex#search',
                noPlacemark: false,
                resultsPerPage: 5
              }
            });

            myMap.controls.add(searchControl);

            // 8. Координаты при клике
            myMap.events.add('click', function (event) {
              var coords = event.get('coords');

              // Если клик по карте (не по метке)
              if (!event.get('target').properties) {
                var clickPlacemark = new ymaps.Placemark(coords, {
                  balloonContent: 'Вы кликнули по координатам: ' +
                    coords[0].toFixed(6) + ', ' + coords[1].toFixed(6)
                }, {
                  preset: 'islands#greenIcon',
                  iconColor: '#00cc00'
                });

                myMap.geoObjects.add(clickPlacemark);

                // Удаляем временную метку через 5 секунд
                setTimeout(function () {
                  myMap.geoObjects.remove(clickPlacemark);
                }, 5000);
              }
            });

            // 9. Обработчики для кнопок
            var mapButtons = document.querySelectorAll('.map-btn');

            if (mapButtons.length === 0) {
              console.warn('Кнопки .map-btn не найдены');
            } else {
              mapButtons.forEach(function (btn) {
                // Удаляем старые обработчики если есть
                btn.replaceWith(btn.cloneNode(true));
              });

              // Получаем обновленные кнопки
              mapButtons = document.querySelectorAll('.map-btn');

              mapButtons.forEach(function (btn) {
                btn.addEventListener('click', function (e) {
                  e.preventDefault();

                  var type = this.getAttribute('data-type');
                  console.log('Смена типа карты на:', type);

                  try {
                    myMap.setType('yandex#' + type);

                    // Обновляем активную кнопку
                    mapButtons.forEach(function (b) {
                      b.classList.remove('active');
                    });
                    this.classList.add('active');

                  } catch (error) {
                    console.error('Ошибка смены типа карты:', error);
                  }
                });
              });

              // Устанавливаем первую кнопку активной
              if (mapButtons.length > 0 && !document.querySelector('.map-btn.active')) {
                mapButtons[0].classList.add('active');
              }
            }

            // 10. Добавляем обработку ошибок карты
            myMap.events.add('error', function (error) {
              console.error('Ошибка Яндекс.Карт:', error);
            });

          } catch (error) {
            console.error('Критическая ошибка создания карты:', error);
            mapContainer.innerHTML = '<div style="padding: 20px; color: red; text-align: center;">Ошибка загрузки карты</div>';
          }
        });
      </script>



</section>
