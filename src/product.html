<!DOCTYPE html>
<html lang="ru" class="page">

@include('partials/head.html')

<body class="page__body">

  <div class="site-container">
    <div class="overlay"></div>
    @include('partials/header-inner.html')
    <main class="main">
      <!-- <div style="height: 3000px;"></div> -->
      @include('partials/product-hero.html')
      @include('partials/product-test.html')

    </main>
    @include('partials/popup.html')
    @include('partials/modal.html')
    @include('partials/footer.html')
    <!-- @include('html/h1.html') пример include -->
  </div>
  <script defer src="js/main.js"></script>
  <script>
    import vars from "./js/_vars.js";

    document.addEventListener('DOMContentLoaded', function () {
      // Проверяем, что переменная существует
      if (!vars || !vars.catalogFilterBlocks) {
        console.error('vars.catalogFilterBlocks не определена!');
        return;
      }

      console.log('Блоков найдено:', vars.catalogFilterBlocks.length);

      if (vars.catalogFilterBlocks.length) {
        vars.catalogFilterBlocks.forEach((block, index) => {
          const btn = block.querySelector(".catalog-filter__btn");
          const inner = block.querySelector(".catalog-filter__inner");

          // Проверяем, что элементы внутри блока найдены
          if (!btn) {
            console.error(`Не найдена кнопка в блоке ${index}`);
            return;
          }

          if (!inner) {
            console.error(`Не найден inner в блоке ${index}`);
            return;
          }

          console.log(`Настройка блока ${index}:`, { btn, inner });

          btn.addEventListener('click', (e) => {
            console.log(`Клик по блоку ${index}`);

            // Переключаем класс
            block.classList.toggle('catalog-filter__block--open');
            const isOpen = block.classList.contains('catalog-filter__block--open');

            console.log(`Состояние: ${isOpen ? 'открыт' : 'закрыт'}`);

            // Устанавливаем ARIA атрибуты
            btn.setAttribute("aria-expanded", isOpen);
            btn.setAttribute('aria-label', isOpen ? "Закрыть блок" : "Открыть блок");

            // Анимация высоты
            if (isOpen) {
              inner.style.maxHeight = `${inner.scrollHeight}px`;
              // Добавляем transition для плавности
              inner.style.transition = 'max-height 0.3s ease';
            } else {
              inner.style.maxHeight = null;
            }
          });

          // Добавляем обработчик клавиатуры для доступности
          btn.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              btn.click();
            }
          });
        });
      } else {
        console.warn('Блоки фильтра не найдены на странице');
      }
    });

  </script>
  <!-- Инициализируем ПОСЛЕ загрузки DOM -->
  <script>
    const priceRange = document.querySelector('.price-range');

    if (priceRange) {
      console.log('Элемент найден, создаю слайдер...');

      noUiSlider.create(priceRange, {
        start: [0, 50000],
        connect: true,
        range: {
          'min': 0,
          'max': 50000
        },
        step: 1000, // Шаг для удобства
        tooltips: true, // Показать значения
        format: {
          to: function (value) {
            return Math.round(value).toLocaleString('ru-RU') + ' ₽';
          },
          from: function (value) {
            return Number(value.replace(/\s/g, '').replace('₽', ''));
          }
        }
      });

      // Для отладки: красим слайдер
      priceRange.style.backgroundColor = '#f0f0f0';
      priceRange.style.padding = '20px';
      priceRange.style.borderRadius = '8px';

    } else {
      console.error('Элемент .price-range не найден!');
    }
  </script>
</body>

</html>
